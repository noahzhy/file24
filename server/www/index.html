<!DOCTYPE html>
<html>
<head>
    <title>Keep file for me</title>
    <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
</head>
<body>
    <h1>Keep file for me</h1>
    <h2>For New</h2>

    <h3>Step 1, Nick Name</h3>
    <p>Enter your nick name, or remember this</p>
    <input type="text" id="username" />

    <h3>Step 2, Upload files</h3>
    <p>Files will be deleted after 24 hours</p>
    <input type="file" id="inputfile" multiple="multiple" />

    <h2>For Old</h2>
    <p>Enter your name to view your files.</p>
    <input type="text" id="userspace" onkeypress="if(event.keyCode==13) {toUserSpace()}"/>
    <input type="submit" value="Go" onclick="toUserSpace()"/>

    <script>
        const usernameInput = document.querySelector('#username');
        usernameInput.placeholder = "tim";

        const toUserSpace = function (data) {
            document.location.href = $('#userspace').val();
        };

        const fileInput = document.querySelector('#inputfile');
        fileInput.onchange = (e) => {
            const body = new FormData();
            var userName = usernameInput.value;
            console.log(userName);
            if (userName == "") {
                userName = usernameInput.placeholder;
            }
            body.append('userName', userName);
            body.append('uploadTime', new Date().toLocaleString());
            for (let i = 0; i < e.target.files.length; i++) {
                body.append('file', e.target.files[i]);
            }
            upload(body);
            // clear file input
            alert('Upload Successfully!');
            $('#inputfile').val('');
            // to specific page
            document.location.href = userName;
        };
        async function upload(data) {
            const response = await fetch('/upload', {
                method: 'POST',
                body: data,
            });
            console.log(response);
        }

    </script>
</body>
</html>
